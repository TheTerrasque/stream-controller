{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>{% block title %}Streamer{% endblock %}</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <link rel="shortcut icon" type="image/ico" href="{% static 'favicon.ico' %}" />
    <link rel="stylesheet" href="{% static 'dark-theme.css' %}" />
    <script>
        // Apply saved theme immediately to prevent flash
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark-theme-pending');
        }
    </script>
    <style>
        html.dark-theme-pending { background-color: #1a1a1a; }
    </style>
</head>

<body>
    <div class="container">
        {% if user.is_authenticated %}
        <div class="row">
            <div class="col">
                Logged in as {{ user.username }}
            </div>
            <div class="col">
                <div class="btn-group">
                    <a href="/streams" class="btn btn-primary">Streams</a>
                    {% if user.is_staff %}
                        <a href="/admin" class="btn btn-primary">Admin</a>
                    {% endif %}
                    <a href="/streams/film/upload" class="btn btn-primary">Upload film</a>
                    <a href="{% url 'account_account' %}" class="btn btn-primary">Account</a>
                    <button type="button" class="btn btn-outline-secondary" id="theme-toggle"></button>
                </div>
            </div>
            {% endif %}
            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-3" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            {% endif %}
            {% block content %}{% endblock %}
        </div>
    </div>
    <script>
        (function() {
            const toggle = document.getElementById('theme-toggle');
            const savedTheme = localStorage.getItem('theme');
            document.documentElement.classList.remove('dark-theme-pending');

            function applyTheme(isDark) {
                if (isDark) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
                if (toggle) {
                    toggle.textContent = isDark ? '\u263C' : '\u263E';
                }
            }

            applyTheme(savedTheme === 'dark');

            if (toggle) {
                toggle.addEventListener('click', function() {
                    const isDark = !document.body.classList.contains('dark-theme');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                    applyTheme(isDark);
                });
            }
        })();
    </script>
</body>

</html>